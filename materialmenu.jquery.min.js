/**
 * Available for use under the MIT License (http://en.wikipedia.org/wiki/MIT_License)
 * 
 * Original Work Copyright (c) 2014 - 2015 by Adam Banaszkiewicz
 * Modified Work Copyright (c) 2017 by Matthew Sigley
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 * @version 1.0.1
 * @date    2018.04.18
 * @author  Matthew Sigley, Adam Banaszkiewicz
 */
(function(b){b.fn.materialmenu=function(d){d=b.extend({mobileWidth:767,width:250,animationTime:200,overlayOpacity:.4,buttonClass:"material-menu-button",buttonHTML:'<div class="material-menu-button"><span></span><span></span><span></span></div>',title:"",showTitle:!1,titleShowOn:40,hideOnClick:!0,onOpen:function(b){},onClose:function(b){},onChangeMobile:function(b){b.parent().parent().addClass("vertical")},onChangeDesktop:function(b){b.parent().parent().removeClass("vertical")},onShowTitlebar:function(b){},
onHideTitlebar:function(b){}},d);var f=function(d,f){var g=this;this.options=f;this.element=d;this.overlay=b([]);this.title=b([]);this.touchPassiveSupported=this.changedOnDesktop=this.changedOnMobile=this.isShowed=this.isTitleShowed=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){g.touchPassiveSupported=!0}}))}catch(a){}this.touchPosStart={y:0,x:0};this.touchPosEnd={y:0,x:0};this.init=function(){var a=this;this.prepare();this.showMenuDependentByWidth();
this.bindEvents();b(window).resize(function(){a.showMenuDependentByWidth()})};this.prepare=function(){this.element.wrap(b("<div />",{"class":"material-menu-wrapper"}));if(this.options.showTitle){var a=b(".material-menu-titlebar");0==a.length?(b("<div />",{"class":"material-menu-titlebar",style:"display:block;position:fixed;left:0px;top:0px;width:100%;height:55px;background-color:#fff;z-index:999998;"}).appendTo("body"),this.title=b(".material-menu-titlebar"),this.title.append(b(this.options.buttonHTML).addClass(this.options.buttonClass).css({"float":"left",
margin:"5px"})),this.title.append('<div class="material-menu-title" style="float:left;line-height:55px;height:55px;margin-left:10px;">'+this.options.title+"</div>"),0==this.options.titleShowOn?this.showTitle():this.hideTitle()):this.title=a;this.title.hide()}this.submenus=this.element.find("li > ul");this.submenus.each(function(a,c){b(c).parent().append('<a class="arrow">&#9658;</a>')});this.submenusClose();a=b(".material-menu-overlay");1==a.length?this.overlay=a:(b("<div />",{"class":"material-menu-overlay",
style:"display:block;position:fixed;left:0px;top:0px;width:100%;height:100%;z-index:999998;background-color:#000000;"}).appendTo("body"),this.overlay=b(".material-menu-overlay"));this.overlay.fadeTo(0,0).css("display","none")};this.bindEvents=function(){var a=this;b("."+this.options.buttonClass).click(function(){a.isShowed?a.close():a.open()});this.overlay.click(function(){a.close()});b(window).scroll(function(){b(this).scrollTop()>=a.options.titleShowOn?a.showTitle():a.hideTitle()});b(window).scrollTop()>=
a.options.titleShowOn&&a.showTitle();this.bindSubmenuEvents();a.options.hideOnClick&&a.element.find("a").click(function(){a.close()});this.bindTouchClose()};this.bindSubmenuEvents=function(){this.submenus.length&&this.submenus.each(function(a,e){var c=b(e);c.clickEventHandler=function(a){a.preventDefault();c.show();c.parent().removeClass("submenu-hidden").addClass("submenu-shown");c.parent().children(".arrow").html("&#9660;").one("click",function(a){a.preventDefault();a.stopPropagation();c.hide();
b(this).html("&#9658;");b(this).parent().removeClass("submenu-shown").addClass("submenu-hidden").one("click",c.clickEventHandler)});return!1};c.parent().one("click",c.clickEventHandler)})};this.showMenuDependentByWidth=function(){this.getWindowWidth()<=this.options.mobileWidth?this.showForMobile():this.showForDesktop();this.isShowed&&this.close()};this.showForMobile=function(){if(0==this.changedOnMobile){var a=this.element.parent();a.removeClass("material-menu-view-desktop").addClass("material-menu-view-mobile").css({display:"none",
position:"fixed",top:"0px",zIndex:"999999",overflow:"auto","-webkit-overflow-scrolling":"touch",height:"100%",width:this.getMenuWidth()+"px",left:"-"+this.getMenuWidth()+"px"});a.get(0).style&&a.get(0).style.WebkitOverflowScrolling&&(a.get(0).style.WebkitOverflowScrolling="touch");this.options.showTitle&&this.showTitle();this.changedOnDesktop=!1;this.changedOnMobile=!0;this.options.onChangeMobile(this.element)}};this.showForDesktop=function(){0==this.changedOnDesktop&&(this.element.parent().removeClass("material-menu-view-mobile").addClass("material-menu-view-desktop").css({display:"block",
position:"static",top:"auto",zIndex:"auto",overflow:"visible",height:"auto",width:"auto",left:"auto"}),this.options.showTitle&&this.hideTitle(),this.changedOnDesktop=!0,this.changedOnMobile=!1,this.options.onChangeDesktop(this.element))};this.open=function(){0==this.isShowed&&this.getWindowWidth()<=this.options.mobileWidth&&(this.isShowed=!0,this.element.parent().show().animate({left:"0px"},this.options.animationTime),this.overlay.css("display","block").fadeTo(this.options.animationTime,this.options.overlayOpacity),
b("body, html").css("overflow","hidden"),this.options.onOpen(this.element))};this.close=function(){var a=this;1==a.isShowed&&(a.isShowed=!1,a.element.parent().animate({left:"-"+a.getMenuWidth()+"px"},a.options.animationTime,function(){b(this).hide()}),a.overlay.fadeTo(a.options.animationTime,0,function(){b(this).css("display","none");a.options.onClose(a.element);a.submenusClose();a.bindSubmenuEvents()}),b("body, html").css("overflow","visible"))};this.submenusClose=function(){this.submenus.length&&
this.submenus.each(function(a,e){var c=b(e);c.hide();c.parent().removeClass("submenu-shown").addClass("submenu-hidden");c.parent().children(".arrow").html("&#9658;")})};this.showTitle=function(){0==this.isTitleShowed&&1==this.changedOnMobile&&(this.title.show().fadeTo(this.options.animationTime,1),this.isTitleShowed=!0,this.options.onShowTitlebar(this.title))};this.hideTitle=function(){1==this.isTitleShowed&&(this.title.fadeTo(this.options.animationTime,0,function(){b(this).hide()}),this.isTitleShowed=
!1,this.options.onHideTitlebar(this.title))};this.bindTouchClose=function(){var a=this,b=[this.element,this.overlay],c;for(c in b)b[c][0]&&b[c][0].addEventListener&&!b[c].data("materialmenu-binded-touchclose")&&(b[c].data("materialmenu-binded-touchclose","1"),console.log(a.touchPassiveSupported),b[c][0].addEventListener("touchstart",function(b){a.touchPosStart.x=b.touches[0].pageX;a.touchPosStart.y=b.touches[0].pageY;a.touchPosEnd.x=b.touches[0].pageX;a.touchPosEnd.y=b.touches[0].pageY},a.touchPassiveSupported?
{passive:!1}:!1),b[c][0].addEventListener("touchend",function(b){console.log(a.getTouchDirection());"left"==a.getTouchDirection()&&a.close()},!1),b[c][0].addEventListener("touchmove",function(b){a.touchPosEnd.x=b.touches[0].pageX;a.touchPosEnd.y=b.touches[0].pageY},a.touchPassiveSupported?{passive:!1}:!1))};this.getMenuWidth=function(){return this.options.width};this.getWindowWidth=function(){return"number"==typeof window.innerWidth?window.innerWidth:document.documentElement&&(document.documentElement.clientWidth||
document.documentElement.clientHeight)?document.documentElement.clientWidth:document.body&&(document.body.clientWidth||document.body.clientHeight)?document.body.clientWidth:b("body, html").width()};this.getTouchDirection=function(){var a=Math.abs(this.touchPosStart.x-this.touchPosEnd.x),b=Math.abs(this.touchPosStart.y-this.touchPosEnd.y);return 100>b&&100>a?"none":a>b?this.touchPosStart.x>this.touchPosEnd.x?"left":"right":this.touchPosStart.y>this.touchPosEnd.y?"up":"down"}};return b(this).each(function(){(new f(b(this),
d)).init()})}})(jQuery);
